<div class="dashboard-container">
  <header class="dashboard-header">
    <h1>ğŸŒ¡ï¸ Tableau de Bord IoT - DHT11</h1>
    <div class="header-controls">
      <select [(ngModel)]="selectedHours" (change)="onHoursChange()" class="time-selector">
        <option *ngFor="let hours of hoursOptions" [value]="hours">
          {{ hours }}h
        </option>
      </select>
      <button (click)="refresh()" class="refresh-btn">ğŸ”„ Actualiser</button>
    </div>
  </header>

  <!-- Message d'erreur -->
  <div *ngIf="error" class="error-message">
    âš ï¸ {{ error }}
  </div>

  <!-- Chargement -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Chargement des donnÃ©es...</p>
  </div>

  <!-- DonnÃ©es actuelles -->
  <div *ngIf="!isLoading && currentData" class="current-data-section">
    <h2>ğŸ“Š DonnÃ©es en temps rÃ©el</h2>
    
    <div class="data-cards">
      <div class="data-card temperature-card">
        <div class="card-icon" [style.color]="getTemperatureColor()">ğŸŒ¡ï¸</div>
        <div class="card-content">
          <h3>TempÃ©rature</h3>
          <div class="value" [style.color]="getTemperatureColor()">
            {{ currentData.temperature.toFixed(1) }}Â°C
          </div>
          <p class="timestamp">{{ formatDate(currentData.timestamp) }}</p>
        </div>
      </div>

      <div class="data-card humidity-card">
        <div class="card-icon" [style.color]="getHumidityColor()">ğŸ’§</div>
        <div class="card-content">
          <h3>HumiditÃ©</h3>
          <div class="value" [style.color]="getHumidityColor()">
            {{ currentData.humidity.toFixed(0) }}%
          </div>
          <p class="timestamp">{{ formatDate(currentData.timestamp) }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistiques -->
  <div *ngIf="!isLoading && stats" class="stats-section">
    <h2>ğŸ“ˆ Statistiques ({{ selectedHours }}h)</h2>
    
    <div class="stats-grid">
      <div class="stat-item">
        <span class="stat-label">ğŸŒ¡ï¸ Temp. Moyenne:</span>
        <span class="stat-value">{{ stats.avgTemp?.toFixed(1) }}Â°C</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">ğŸ”» Temp. Min:</span>
        <span class="stat-value">{{ stats.minTemp?.toFixed(1) }}Â°C</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">ğŸ”º Temp. Max:</span>
        <span class="stat-value">{{ stats.maxTemp?.toFixed(1) }}Â°C</span>
      </div>
      
      <div class="stat-item">
        <span class="stat-label">ğŸ’§ Hum. Moyenne:</span>
        <span class="stat-value">{{ stats.avgHum?.toFixed(0) }}%</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">ğŸ”» Hum. Min:</span>
        <span class="stat-value">{{ stats.minHum?.toFixed(0) }}%</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">ğŸ”º Hum. Max:</span>
        <span class="stat-value">{{ stats.maxHum?.toFixed(0) }}%</span>
      </div>

      <div class="stat-item">
        <span class="stat-label">ğŸ“Š Mesures:</span>
        <span class="stat-value">{{ stats.count }}</span>
      </div>
    </div>
  </div>

  <!-- Historique -->
  <div *ngIf="!isLoading && historyData.length > 0" class="history-section">
    <h2>ğŸ“œ Historique rÃ©cent</h2>
    
    <div class="history-table-container">
      <table class="history-table">
        <thead>
          <tr>
            <th>Date & Heure</th>
            <th>TempÃ©rature</th>
            <th>HumiditÃ©</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of historyData.slice(-20).reverse()">
            <td>{{ formatDate(data.timestamp) }}</td>
            <td>
              <span [style.color]="getTemperatureColorForValue(data.temperature)">
                {{ data.temperature.toFixed(1) }}Â°C
              </span>
            </td>
            <td>
              <span [style.color]="getHumidityColorForValue(data.humidity)">
                {{ data.humidity.toFixed(0) }}%
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Message si pas de donnÃ©es -->
  <div *ngIf="!isLoading && !currentData && !error" class="no-data">
    <p>ğŸ˜” Aucune donnÃ©e disponible</p>
    <p>Assurez-vous que votre ESP8266 envoie des donnÃ©es au broker MQTT</p>
  </div>
</div>
